<!DOCTYPE html>
<html lang="ku" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>یاری وشەی ئۆنلاین - ڕاید عبدالله</title>
    
    <script src="https://www.gstatic.com/firebasejs/9.1.3/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.1.3/firebase-database-compat.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        @font-face { font-family: 'UniMahan'; src: url('UniMahanBilal.ttf') format('truetype'); }
        body {
            margin: 0; background: #000; font-family: 'UniMahan', sans-serif; color: white;
            display: flex; flex-direction: column; align-items: center; height: 100vh; 
            height: -webkit-fill-available; overflow: hidden;
            background-image: radial-gradient(at 50% 0%, hsla(280,40%,15%,1) 0, transparent 50%);
        }

        .header-container {
            width: 95%; max-width: 450px; margin-top: 10px;
            background: rgba(255, 255, 255, 0.07); backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 18px; padding: 10px 15px;
            display: flex; justify-content: space-between; align-items: center; box-sizing: border-box;
            z-index: 100;
        }

        .back-btn {
            color: #fff; text-decoration: none; width: 35px; height: 35px;
            display: flex; align-items: center; justify-content: center;
            background: rgba(255, 255, 255, 0.1); border-radius: 10px;
        }

        .screen { display: none; width: 95%; max-width: 400px; flex-direction: column; gap: 10px; height: 85vh; justify-content: center; }
        .active { display: flex; }

        input {
            background: rgba(255,255,255,0.08); border: 2px solid #a78bfa;
            padding: 12px; border-radius: 12px; color: white; font-family: 'UniMahan'; 
            outline: none; font-size: 1.1rem; text-align: center; width: 100%; box-sizing: border-box;
            transition: all 0.3s ease;
        }

        .wrong-answer {
            border-color: #ef4444 !important;
            background: rgba(239, 68, 68, 0.15) !important;
            animation: shake 0.4s ease-in-out;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-8px); }
            50% { transform: translateX(8px); }
            75% { transform: translateX(-8px); }
        }

        button {
            background: #7c3aed; color: white; border: none; padding: 12px;
            border-radius: 12px; font-family: 'UniMahan'; cursor: pointer; transition: 0.3s;
        }

        .word-glow {
            font-size: 2.1rem; color: #a78bfa; text-align: center;
            text-shadow: 0 0 15px #7c3aed; letter-spacing: 5px; margin: 10px 0;
            background: rgba(124, 58, 237, 0.1); padding: 20px; border-radius: 15px;
            border: 1px solid rgba(167, 139, 250, 0.3);
        }

        .word-correct { color: #10b981 !important; text-shadow: 0 0 20px #10b981 !important; letter-spacing: 2px !important; }

        .leaderboard {
            background: rgba(255, 255, 255, 0.05); border-radius: 15px; padding: 10px;
            border: 1px solid rgba(167, 139, 250, 0.2); overflow-y: auto; flex-grow: 1; margin-bottom: 10px;
        }

        .player-row { display: flex; justify-content: space-between; padding: 8px; border-bottom: 1px solid rgba(255,255,255,0.05); }
        .me { color: #0ff; font-weight: bold; }
        
        .pass-btn { background: #ef4444; flex: 1; }
        .voted { background: #10b981 !important; }

        .status-bar { display: flex; justify-content: space-between; font-size: 0.85rem; color: #a78bfa; margin-top: 15px; margin-bottom: 5px; padding: 0 5px; }
    </style>
</head>
<body id="main-body">

    <div class="header-container">
        <div style="display: flex; align-items: center; gap: 10px;">
            <i class="fas fa-gamepad" style="color: #a78bfa;"></i>
            <span style="font-weight: bold;">یاری وشەکان</span>
        </div>
        <a href="home.html" class="back-btn"><i class="fas fa-chevron-left"></i></a>
    </div>

    <div id="login-screen" class="screen active">
        <h2 style="text-align: center; color: #a78bfa;">چوونە ژوورەوە</h2>
        <input type="text" id="username" placeholder="ناوەکەت">
        <input type="text" id="room-id" placeholder="کۆدی ژوور">
        <button onclick="joinGame()">دەستپێکردن</button>
    </div>

    <div id="game-screen" class="screen">
        <div class="status-bar">
            <span id="display-room">ژوور: ---</span>
            <span id="pass-count">پاس: 0/0</span>
        </div>
        
        <div id="scrambled-word" class="word-glow">---</div>
        <input type="text" id="user-guess" placeholder="وەڵامەکە بنووسە..." autocomplete="off">
        
        <div style="display: flex; gap: 10px;">
            <button style="flex: 2;" onclick="checkAnswer()">ناردن</button>
            <button id="pass-btn-ui" onclick="togglePass()" class="pass-btn">پاس</button>
        </div>
        
        <div id="winner-text" style="color:#10b981; text-align:center; height:20px; font-size: 0.9rem; margin-top: 5px;"></div>
        <div id="leaderboard" class="leaderboard"></div>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyDKhKfrzq69GVPPB8rbRTxJYvTT1GpMMOs",
            authDomain: "raydgame-5f67f.firebaseapp.com",
            databaseURL: "https://raydgame-5f67f-default-rtdb.firebaseio.com",
            projectId: "raydgame-5f67f",
            storageBucket: "raydgame-5f67f.firebasestorage.app",
            messagingSenderId: "95248784851",
            appId: "1:95248784851:web:874393b81fde832f362326"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        let myName = "", myRoom = "", currentWord = "", myScore = 0, hasVoted = false, isLock = false;

        // لیستی وشەکان (ناوەکەیم کردەوە بە wordsList بۆ ئەوەی لە هەموو شوێنێک کار بکات)
        const wordsList = [
            "رۆژنامە", "پێنوس", "دەفتەر", "وێنە", "رەنگ", "تابلۆ", "مۆسیقا", "هۆنراوە", "چیرۆک",
            "خوێندن", "قوتابخانە", "زانکۆ", "مامۆستا", "دکتۆر", "ئەندازیار", "وەرزش", "تۆپ", "یاری", "سەرکەوتن",
            "کار", "هەوڵ", "ئومێد", "بڕوا", "ڕاستی", "دادپەروەری", "خۆشەویستی", "دۆستایەتی", "بەرپرسیارێتی", "خێزان",
            "دایک", "باوک", "برا", "خوشک", "هاوڕێ", "دراوسێ", "مرۆڤ", "ژینگە", "پاراستن", "تەندروستی",
            "خۆراک", "نان", "ئاو", "گۆشت", "سەوزە", "میوە", "هەنگوین", "ماست", "پەنیر", "چای",
            "قاوە", "شەکر", "خوێ", "بیبەر", "پیاز", "تەماتە", "خەیار", "گێزەر", "سیر", "سپیناخ",
            "کەوچک", "چەتاڵ", "چەقۆ", "قاپ", "پەرداخ", "کتلێ", "سەلاجە", "فڕن", "تەباخ", "ژوور",
            "نوستن", "خەو", "خەیاڵ", "هەست", "گریان", "پێکەنین", "دەنگ", "بێدەنگی", "تاریکی", "ڕوناکی",
            "مۆم", "گڵۆپ", "کارەبا", "ئاگر", "دووکەڵ", "خۆڵەمێش", "خۆڵ", "بەرد", "لم", "قوڕ",
            "ئاسن", "زێڕ", "زیو", "مس", "دار", "تەختە", "پلاستیک", "شوشە", "کاغەز", "قوماش",
            "جلوبەرگ", "کڵاو", "جامانە", "کەوا", "پانتۆڵ", "کراس", "پێڵاو", "گۆرەوی", "دەستکێش", "چاکەت",
            "سەعات", "ئەلقە", "ملوانکە", "گواره", "کلیل", "قوفڵ", "کیسە", "جانتا", "سەفەر", "ڕێگا",
            "ئۆتۆمبێل", "پاس", "فڕۆکە", "کەشتی", "شەمەندەفەر", "پایسکیل", "ماتۆڕ", "تەکنەلۆژیا", "ئینتەرنێت", "نامە",
            "هەواڵ", "ڕادیۆ", "تەلەفزیۆن", "فیلم", "شانۆ", "سەما", "شەقام", "کۆڵان", "بازاڕ", "دوکان",
            "نەخۆشخانە", "دەرمانخانە", "بانک", "پارە", "هەژمار", "کڕین", "فرۆشتن", "نرخ", "قازانج", "هەرزان",
            "گران", "کوالێتی", "باخچە", "پارک", "سێبەر", "گەڵا", "چڵ", "ڕەگ", "تۆو", "خاک",
            "کێو", "لوتکە", "ئەشکەوت", "دۆڵ", "تاڤگە", "گۆم", "زەریا", "شەپۆل", "سەهۆڵ", "بەفر",
            "تەرزە", "تەم", "باکور", "باشور", "ڕۆژهەڵات", "ڕۆژئاوا", "نەخشە", "جیهان", "گەردوون", "هەسارە",
            "مەریخ", "زوحەل", "نەپتون", "تیشک", "سۆزی", "گەرمی", "ساردی", "شێداری", "وشکانی", "بومەلەرزە",
            "با", "گەردەلوول", "برووسکە", "هەورەبروسکە", "وەرز", "کات", "چرکە", "خولەک", "کاتژمێر", "ڕۆژ",
            "هەفتە", "مانگ", "ساڵ", "سەدە", "مێژوو", "ئێستا", "داهاتوو", "ڕابردوو", "هەمیشە", "گیزەگیز",
            "مێش", "مێروولە", "پەپوولە", "کوللە", "دووپشک", "مار", "کۆڵەک", "کەروێشک", "گورگ", "چەقەڵ"
        ];

        function joinGame() {
            myName = document.getElementById('username').value.trim();
            myRoom = document.getElementById('room-id').value.trim();
            if(!myName || !myRoom) return alert("تکایە ناو و کۆد بنووسە");
            
            const roomRef = db.ref('rooms/' + myRoom);
            roomRef.child('players').child(myName).set({ score: 0, votePass: false });
            
            roomRef.child('word').once('value', (s) => {
                if(!s.val()) roomRef.update({ word: wordsList[Math.floor(Math.random() * wordsList.length)], winner: "" });
            });

            document.getElementById('login-screen').classList.remove('active');
            document.getElementById('game-screen').classList.add('active');
            document.getElementById('display-room').innerText = "کۆد: " + myRoom;
            listenData();
        }

        function listenData() {
            const roomRef = db.ref('rooms/' + myRoom);
            
            roomRef.child('word').on('value', (snap) => {
                const newWord = snap.val();
                if(newWord && currentWord !== newWord) {
                    currentWord = newWord;
                    isLock = false; 
                    document.getElementById('scrambled-word').innerText = shuffle(currentWord);
                    document.getElementById('scrambled-word').classList.remove('word-correct');
                    document.getElementById('user-guess').value = "";
                    document.getElementById('winner-text').innerText = "";
                }
            });

            roomRef.child('winner').on('value', (snap) => {
                const winner = snap.val();
                if(winner) {
                    isLock = true;
                    document.getElementById('scrambled-word').innerText = currentWord;
                    document.getElementById('scrambled-word').classList.add('word-correct');
                    document.getElementById('winner-text').innerText = winner + " وشەکەی زانی! (+10)";
                    
                    if(winner === myName) {
                        setTimeout(() => {
                            const nextWord = wordsList[Math.floor(Math.random() * wordsList.length)];
                            const updates = {};
                            updates['word'] = nextWord;
                            updates['winner'] = "";
                            roomRef.update(updates);
                            
                            roomRef.child('players').once('value', (p) => {
                                p.forEach(c => {
                                    roomRef.child('players/' + c.key).update({ votePass: false });
                                });
                            });
                        }, 3500);
                    }
                }
            });

            roomRef.child('players').on('value', (snap) => {
                const players = snap.val() || {};
                const lb = document.getElementById('leaderboard');
                lb.innerHTML = "";
                let votes = 0, total = Object.keys(players).length;

                Object.entries(players).sort((a,b) => b[1].score - a[1].score).forEach(([name, data]) => {
                    if(data.votePass) votes++;
                    if(name === myName) {
                        myScore = data.score;
                        hasVoted = data.votePass;
                        document.getElementById('pass-btn-ui').className = hasVoted ? "pass-btn voted" : "pass-btn";
                        document.getElementById('pass-btn-ui').innerText = hasVoted ? "پاشگەزبۆوە" : "پاس";
                    }
                    lb.innerHTML += `<div class="player-row ${name===myName?'me':''}">
                        <span>${name} ${data.votePass?'✅':''}</span>
                        <span>${data.score} خاڵ</span>
                    </div>`;
                });

                document.getElementById('pass-count').innerText = `پاس: ${votes}/${total}`;
                
                if(votes >= total && total > 0 && !isLock) {
                    const firstInList = Object.keys(players).sort()[0];
                    if(myName === firstInList) {
                        const nextWord = wordsList[Math.floor(Math.random() * wordsList.length)];
                        roomRef.update({ word: nextWord });
                        roomRef.child('players').once('value', (p) => {
                            p.forEach(c => {
                                roomRef.child('players/' + c.key).update({ votePass: false });
                            });
                        });
                    }
                }
            });
        }

        function checkAnswer() {
            if(isLock) return;
            const input = document.getElementById('user-guess');
            const guess = input.value.trim();
            
            if(guess === currentWord) {
                db.ref('rooms/'+myRoom+'/players/'+myName).update({ score: myScore + 10 });
                db.ref('rooms/'+myRoom).update({ winner: myName });
            } else {
                input.classList.add('wrong-answer');
                setTimeout(() => {
                    input.classList.remove('wrong-answer');
                }, 400);
            }
        }

        function togglePass() {
            if(isLock) return;
            db.ref('rooms/'+myRoom+'/players/'+myName).update({ votePass: !hasVoted });
        }

        function shuffle(s) {
            let a = s.split(""), n = a.length;
            for(let i=n-1; i>0; i--) {
                let j = Math.floor(Math.random()*(i+1));
                [a[i],a[j]] = [a[j],a[i]];
            }
            return a.join(" ");
        }

        document.getElementById('user-guess').addEventListener('keypress', (e) => { if(e.key === 'Enter') checkAnswer(); });
    </script>
</body>
</html>
