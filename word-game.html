<!DOCTYPE html>
<html lang="ku" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>یاری وشەی ئۆنلاین - ڕاید عبدالله</title>
    
    <script src="https://www.gstatic.com/firebasejs/9.1.3/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.1.3/firebase-database-compat.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        @font-face { font-family: 'UniMahan'; src: url('UniMahanBilal.ttf') format('truetype'); }
        body {
            margin: 0; background: #000; font-family: 'UniMahan', sans-serif; color: white;
            display: flex; flex-direction: column; align-items: center; height: 100vh; overflow: hidden;
            background-image: radial-gradient(at 50% 0%, hsla(280,40%,15%,1) 0, transparent 50%);
        }

        /* لاکێشەی جیاواز بۆ بەشی سەرەوە */
        .header-container {
            width: 95%; max-width: 450px; margin-top: 15px; margin-bottom: 10px;
            background: rgba(255, 255, 255, 0.07); backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px); border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 18px; padding: 12px 18px; display: flex;
            justify-content: space-between; align-items: center; box-shadow: 0 8px 32px rgba(0,0,0,0.5);
            box-sizing: border-box; z-index: 100;
        }

        .back-btn {
            color: #fff; text-decoration: none; font-size: 1rem; width: 38px; height: 38px;
            display: flex; align-items: center; justify-content: center;
            background: rgba(255, 255, 255, 0.1); border-radius: 12px; transition: 0.3s;
        }
        .back-btn:hover { background: rgba(255, 255, 255, 0.2); color: #0ff; transform: translateX(-3px); }

        .screen { display: none; width: 90%; max-width: 400px; flex-direction: column; gap: 10px; animation: fadeIn 0.5s; }
        .active { display: flex; }

        input {
            background: rgba(255,255,255,0.08); border: 2px solid #0ff;
            padding: 12px; border-radius: 12px; color: white; font-family: 'UniMahan'; outline: none; font-size: 1.1rem;
            text-align: center; width: 100%; box-sizing: border-box;
        }
        .btn-container { display: flex; gap: 8px; width: 100%; }
        button {
            background: #7c3aed; color: white; border: none; padding: 12px;
            border-radius: 12px; font-family: 'UniMahan'; cursor: pointer; flex: 2;
        }
        .pass-btn { background: #ef4444; flex: 1; font-size: 0.8rem; }
        
        .word-glow {
            font-size: 2.2rem; color: #a78bfa; text-align: center;
            text-shadow: 0 0 15px #7c3aed; letter-spacing: 8px; margin: 10px 0;
            background: rgba(124, 58, 237, 0.1); padding: 15px; border-radius: 15px;
            border: 1px solid rgba(167, 139, 250, 0.3);
        }
        .word-correct { color: #10b981 !important; text-shadow: 0 0 20px #10b981 !important; letter-spacing: 2px !important; }
        
        .leaderboard {
            background: rgba(255, 255, 255, 0.05); border-radius: 15px; padding: 10px;
            border: 1px solid rgba(0, 255, 255, 0.2); flex: 1; overflow-y: auto; margin-top: 10px;
        }
        .player-row { display: flex; justify-content: space-between; padding: 8px 12px; border-bottom: 1px solid rgba(255,255,255,0.05); }
        .player-row.me { color: #0ff; background: rgba(0, 255, 255, 0.1); border-radius: 8px; }
        .score-val { color: #10b981; font-weight: bold; }
        
        .status-bar { display: flex; justify-content: space-between; width: 100%; font-size: 0.85rem; color: #a78bfa; margin-bottom: 5px; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .correct-glow { animation: flashGreen 0.6s ease; }
        @keyframes flashGreen { 0% { background: #000; } 50% { background: #064e3b; } 100% { background: #000; } }
    </style>
</head>
<body id="main-body">

    <div class="header-container">
        <div style="display: flex; align-items: center; gap: 12px;">
            <i class="fas fa-gamepad" style="color: #0ff; font-size: 1.2rem; filter: drop-shadow(0 0 5px #0ff);"></i>
            <span style="font-weight: bold; font-size: 1.1rem; letter-spacing: 0.5px;">یاری وشەکان</span>
        </div>
        <a href="home.html" class="back-btn" title="گەڕانەوە">
            <i class="fas fa-chevron-left"></i>
        </a>
    </div>

    <div id="login-screen" class="screen active" style="margin-top: 20px;">
        <h2 style="text-align: center; color: #0ff; text-shadow: 0 0 8px #0ff;">چوونە ناو ژوور</h2>
        <input type="text" id="username" placeholder="ناوەکەت">
        <input type="text" id="room-id" placeholder="کۆدی ژوور">
        <button onclick="joinGame()">دەستپێکردنی کێبڕکێ</button>
    </div>

    <div id="game-screen" class="screen">
        <div class="status-bar">
            <span id="display-room">ژوور: ---</span>
            <span id="pass-count">دەنگی پاس: 0/0</span>
        </div>
        <div id="scrambled-word" class="word-glow">---</div>
        <input type="text" id="user-guess" placeholder="وەڵامەکە بنووسە..." autocomplete="off">
        <div class="btn-container">
            <button onclick="checkAnswer()">ناردن</button>
            <button id="pass-btn-ui" onclick="votePass()" class="pass-btn">پاس (0)</button>
        </div>
        <div id="winner-text" style="color:#10b981; text-align:center; height:22px; font-weight:bold; font-size: 0.9rem; margin-top: 5px;"></div>
        <div id="leaderboard" class="leaderboard"></div>
    </div>

    <script>
        // فایەربەیسەکەی تۆ
        const firebaseConfig = {
            apiKey: "AIzaSyDKhKfrzq69GVPPB8rbRTxJYvTT1GpMMOs",
            authDomain: "raydgame-5f67f.firebaseapp.com",
            databaseURL: "https://raydgame-5f67f-default-rtdb.firebaseio.com",
            projectId: "raydgame-5f67f",
            storageBucket: "raydgame-5f67f.firebasestorage.app",
            messagingSenderId: "95248784851",
            appId: "1:95248784851:web:874393b81fde832f362326"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        let myName = "", myRoom = "", currentWord = "", myScore = 0, isLock = false;
        let totalPlayers = 0;

        // لیستی وشەکان (٤ و ٥ و ٦ پیت)
        const wordsList = [
            "ئاسمان", "باران", "زانکۆ", "مۆبایل", "کتێب", "قەڵەم", "هەور", "بەرد", "مانگ", "ئەسپ", "پشیلە", "مریشک", "هێلکە", "ئاگر", "ژیان", "ئاشتی", "ئازادی", "خەبات", "نەورۆز", "نیسک", "لوبیا", "تەماتە", "بیبەر", "پیاز", "کەوچک", "دەوری", "کاسە", "قۆری", "بازاڕ", "ئەشکەوت", "دەریا", "کانی", "سەوزە", "مراوی", "کۆتر", "هەڵۆ", "ڕێوی", "گورگ", "ئاسک", "مانگا", "حوشتر", "کەژاڵ", "پەری", "فریشتە", "شەیتان", "بەهەشت", "دۆزەخ", "بانک", "شانۆ", "مەتبەخ", "حەمام", "ئاوێنە", "سابوون", "خاولی", "سەرین", "فەرش", "پەردە", "گڵۆپ", "سەعات", "وێنە", "کلیل", "قوفڵ", "جانتا", "مێروو", "کێسەڵ", "داڵان", "جۆگە", "شارۆ", "گوند", "دەشت", "سیروان", "چەقۆ", "پەرداخ", "کتری", "ماست", "کەرە", "برنج", "نۆک", "کاهوو", "خەیار", "سەلک", "تەور", "چەتاڵ", "دوکان", "ئاڵا", "خوێ", "شەکر", "گۆشت", "ماسی", "شیر", "پێڵاو", "کراس", "تەختە", "کورسی", "دیوار", "سەقف", "دەست", "زمان", "ددان", "پەنجە", "مێشک", "خەون", "کاوە", "ورچە", "شێرە", "مەیمون", "فیلە", "حوشتر", "گایان", "مەڕان", "بزنە", "مەلەکە", "قازان", "ماران", "بۆقان", "هەنگە", "مێشە", "پەپولا", "چنار", "بایەخ", "هەناسە", "پاییز", "بەهار", "زستان", "هاوین", "میوە", "هەنار", "هەرمێ", "قەیسی", "ئاڵو", "گێلاس", "هەنجیر", "پرتەقاڵ", "سێوە", "مۆزە", "ترێی", "چیاکان", "فڕۆکە", "کەشتی", "مانگە", "خۆرە", "دارە", "بەردە", "کوردە", "ماڵە", "ژوورە", "بانان", "پردان", "جادە", "کۆڵان", "مەکۆ", "هۆڵە", "بەرگە", "تاریک", "ڕوونە", "ساردە", "گەرمە", "دوکەڵ", "پارە", "زێڕە", "زیوە", "مسین", "ئاسنە", "پۆڵا", "جامە", "مێزە", "کڵاوە", "کەوا", "نینۆک", "لووتە", "چاوە", "گوێچکە", "دڵمان", "گیانە", "خاکە", "ئاوەکە", "باوە", "کێوە", "دۆڵە", "چەمە", "ماسیە", "مەلە", "شێرە", "بزنە", "ئەسپە", "سەگە", "پشیلە", "هێلکە", "شیرە", "پەینە", "جووتە", "جۆیە", "برنجە", "ڕۆنە", "دۆکە", "کەرە", "لۆرە", "کەشکە"
        ];

        function joinGame() {
            myName = document.getElementById('username').value.trim();
            myRoom = document.getElementById('room-id').value.trim();
            if(!myName || !myRoom) return alert("ناو و کۆد بنووسە!");
            const roomRef = db.ref('rooms/' + myRoom);
            roomRef.child('players').child(myName).update({ score: 0, votePass: false });
            roomRef.child('word').once('value', (snap) => {
                if(!snap.val()) roomRef.update({ word: wordsList[Math.floor(Math.random() * wordsList.length)], winner: "" });
            });
            document.getElementById('login-screen').classList.remove('active');
            document.getElementById('game-screen').classList.add('active');
            document.getElementById('display-room').innerText = "کۆد: " + myRoom;
            startListening();
        }

        function startListening() {
            const roomRef = db.ref('rooms/' + myRoom);
            roomRef.child('word').on('value', (snap) => {
                currentWord = snap.val();
                if(currentWord && !isLock) {
                    document.getElementById('scrambled-word').classList.remove('word-correct');
                    document.getElementById('scrambled-word').innerText = shuffle(currentWord);
                    document.getElementById('user-guess').value = "";
                }
            });

            roomRef.child('winner').on('value', (snap) => {
                if(snap.val()) showCorrectAnswer(snap.val());
            });

            roomRef.child('players').on('value', (snap) => {
                const players = snap.val();
                if(!players) return;
                totalPlayers = Object.keys(players).length;
                let passVotes = 0;
                const lb = document.getElementById('leaderboard');
                lb.innerHTML = '';
                
                Object.entries(players).sort((a,b) => b[1].score - a[1].score).forEach(([name, data]) => {
                    if(data.votePass) passVotes++;
                    const row = document.createElement('div');
                    row.className = `player-row ${name === myName ? 'me' : ''}`;
                    row.innerHTML = `<span>${name} ${data.votePass ? '✅' : ''}</span><span class="score-val">${data.score} خاڵ</span>`;
                    lb.appendChild(row);
                    if(name === myName) myScore = data.score;
                });

                document.getElementById('pass-count').innerText = `دەنگی پاس: ${passVotes}/${totalPlayers}`;
                document.getElementById('pass-btn-ui').innerText = `پاس (${passVotes})`;

                if(passVotes >= totalPlayers && totalPlayers > 0) {
                    resetPassVotesAndChangeWord();
                }
            });
        }

        function showCorrectAnswer(winnerName) {
            isLock = true;
            const wordEl = document.getElementById('scrambled-word');
            wordEl.innerText = currentWord;
            wordEl.classList.add('word-correct');
            document.getElementById('winner-text').innerText = `${winnerName} بردیەوە (+10)`;
            triggerFlash();
            setTimeout(() => {
                isLock = false;
                document.getElementById('winner-text').innerText = "";
                wordEl.classList.remove('word-correct');
                if(winnerName === myName) {
                    const roomRef = db.ref('rooms/' + myRoom);
                    roomRef.update({ winner: "", word: wordsList[Math.floor(Math.random() * wordsList.length)] });
                    roomRef.child('players').once('value', (s) => {
                        s.forEach(child => child.ref.update({ votePass: false }));
                    });
                }
            }, 3000);
        }

        function checkAnswer() {
            if(isLock) return;
            if(document.getElementById('user-guess').value.trim() === currentWord) {
                db.ref('rooms/' + myRoom + '/players/' + myName).update({ score: myScore + 10 });
                db.ref('rooms/' + myRoom).update({ winner: myName });
            } else {
                document.getElementById('user-guess').animate([{borderColor:'red'},{borderColor:'#0ff'}], 500);
            }
        }

        function votePass() {
            db.ref('rooms/' + myRoom + '/players/' + myName).update({ votePass: true });
        }

        function resetPassVotesAndChangeWord() {
            const roomRef = db.ref('rooms/' + myRoom);
            roomRef.update({ word: wordsList[Math.floor(Math.random() * wordsList.length)] });
            roomRef.child('players').once('value', (s) => {
                s.forEach(child => child.ref.update({ votePass: false }));
            });
        }

        function shuffle(word) {
            let a = word.split(""), n = a.length;
            for(let i = n - 1; i > 0; i--) {
                let j = Math.floor(Math.random() * (i + 1));
                [a[i], a[j]] = [a[j], a[i]];
            }
            return a.join("  ");
        }

        function triggerFlash() {
            document.getElementById('main-body').classList.add('correct-glow');
            setTimeout(() => document.getElementById('main-body').classList.remove('correct-glow'), 600);
        }

        document.getElementById('user-guess').addEventListener('keypress', (e) => { if (e.key === 'Enter') checkAnswer(); });
    </script>
</body>
</html>
